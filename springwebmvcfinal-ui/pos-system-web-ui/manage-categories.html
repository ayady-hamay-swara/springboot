<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Categories - POS System</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-reboot.min.css">
    <link rel="stylesheet" href="css/bootstrap-grid.min.css">
    <!-- Global Navbar CSS -->
    <link rel="stylesheet" href="css/navbar-global.css">
    <!-- Custom CSS -->
    <style>
        body {
            background: #f5f7fa;
        }
        .page-title {
            color: #2E75B6;
            font-weight: bold;
        }
        .category-card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .category-item {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            transition: all 0.3s;
        }
        .category-item:hover {
            background: #f8f9fa;
        }
        .category-item:last-child {
            border-bottom: none;
        }
        .badge-active {
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
        }
        .badge-inactive {
            background: #dc3545;
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
        }
    </style>
</head>
<body>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         GLOBAL NAVBAR
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary global-navbar">

        <!-- Brand -->
        <a class="navbar-brand font-weight-bold" href="index.html">
            üè™ <span data-i18n="brand_name">POS System</span>
        </a>

        <!-- LEFT SIDE: Settings & Calculator Buttons -->
        <div class="navbar-left-actions">
            <button class="nav-icon-btn" id="btnGlobalSettings" title="Settings">‚öôÔ∏è</button>
            <button class="nav-icon-btn" id="btnGlobalCalc" title="Calculator">üßÆ</button>
        </div>

        <!-- Mobile Toggle -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#globalNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- CENTER: Navigation Links -->
        <div class="collapse navbar-collapse" id="globalNavbar">
            <ul class="navbar-nav mx-auto">
                <li class="nav-item">
                    <a class="nav-link" href="index.html" data-i18n="nav_home">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="manage-customers.html" data-i18n="nav_customers">Customers</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="manage-items.html" data-i18n="nav_items">Items</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="manage-categories.html" data-i18n="nav_categories">Categories</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="manage-employees.html" data-i18n="nav_employees">Employees</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="pos-checkout.html" data-i18n="nav_pos">üõí POS</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="search-orders.html" data-i18n="nav_search">Orders</a>
                </li>
            </ul>

            <!-- RIGHT SIDE: Language Switcher & User Info -->
            <ul class="navbar-nav ml-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="langDropdown"
                       data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        üåê <span id="currentLangLabel">English</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="langDropdown">
                        <a class="dropdown-item" href="#" onclick="setLanguage('en'); return false;">üá¨üáß English</a>
                        <a class="dropdown-item" href="#" onclick="setLanguage('ku'); return false;">üü•üü©‚ö™ ⁄©Ÿàÿ±ÿØ€å</a>
                        <a class="dropdown-item" href="#" onclick="setLanguage('ar'); return false;">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</a>
                    </div>
                </li>
                <li class="nav-item">
                    <span class="nav-link text-warning">
                        üë§ <strong id="navbarUsername">Admin</strong>
                    </span>
                </li>
            </ul>
        </div>

    </nav>


    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         GLOBAL SETTINGS POPUP
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="global-popup" id="globalSettingsPanel">
        <div class="popup-header">
            <span>‚öôÔ∏è <span data-i18n="settings_title">Settings</span></span>
            <button class="popup-close" id="settingsCloseBtn">‚úï</button>
        </div>
        <div class="settings-body">
            <div class="settings-section">
                <div class="settings-label" data-i18n="settings_store">Store Name</div>
                <input type="text" id="globalStoreName" class="settings-input" placeholder="My Store">
            </div>
            <div class="settings-section">
                <div class="settings-label" data-i18n="settings_currency">Default Currency</div>
                <select id="globalCurrency" class="settings-input">
                    <option value="IQD" selected>IQD ‚Äî Iraqi Dinar</option>
                    <option value="$">$ ‚Äî US Dollar</option>
                    <option value="‚Ç¨">‚Ç¨ ‚Äî Euro</option>
                    <option value="¬£">¬£ ‚Äî British Pound</option>
                    <option value="AED">AED ‚Äî UAE Dirham</option>
                </select>
            </div>
            <div class="settings-section">
                <div class="settings-label" data-i18n="settings_tax">Tax Rate (%)</div>
                <input type="number" id="globalTaxRate" class="settings-input" placeholder="0" min="0" max="100" step="0.1">
            </div>
            <div class="settings-section">
                <div class="settings-label" data-i18n="settings_auto_print">Auto-print Receipt</div>
                <label class="toggle-label">
                    <input type="checkbox" id="globalAutoPrint">
                    <span class="toggle-track"></span>
                    <span class="toggle-text">Off</span>
                </label>
            </div>
            <div class="settings-section">
                <div class="settings-label" data-i18n="settings_sound">Sound on Add to Cart</div>
                <label class="toggle-label">
                    <input type="checkbox" id="globalSound" checked>
                    <span class="toggle-track"></span>
                    <span class="toggle-text">On</span>
                </label>
            </div>
            <div class="settings-section">
                <div class="settings-label" data-i18n="settings_cashier_name">Your Name</div>
                <input type="text" id="globalCashierName" class="settings-input" placeholder="Admin">
            </div>
            <button class="settings-save-btn" id="btnGlobalSaveSettings">
                üíæ <span data-i18n="settings_save">Save Settings</span>
            </button>
        </div>
    </div>


    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         GLOBAL CALCULATOR POPUP
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="global-popup" id="globalCalcPanel">
        <div class="popup-header">
            <span>üßÆ <span data-i18n="calc_title">Calculator</span></span>
            <button class="popup-close" id="calcCloseBtn">‚úï</button>
        </div>
        <div class="calc-wrap">
            <div class="calc-display">
                <div class="calc-expr" id="globalCalcExpr">&nbsp;</div>
                <div class="calc-result" id="globalCalcResult">0</div>
            </div>
            <div class="calc-grid">
                <button class="cb cb-fn" data-action="clear">AC</button>
                <button class="cb cb-fn" data-action="sign">+/‚àí</button>
                <button class="cb cb-fn" data-action="percent">%</button>
                <button class="cb cb-op" data-op="√∑">√∑</button>
                <button class="cb" data-num="7">7</button>
                <button class="cb" data-num="8">8</button>
                <button class="cb" data-num="9">9</button>
                <button class="cb cb-op" data-op="√ó">√ó</button>
                <button class="cb" data-num="4">4</button>
                <button class="cb" data-num="5">5</button>
                <button class="cb" data-num="6">6</button>
                <button class="cb cb-op" data-op="‚àí">‚àí</button>
                <button class="cb" data-num="1">1</button>
                <button class="cb" data-num="2">2</button>
                <button class="cb" data-num="3">3</button>
                <button class="cb cb-op" data-op="+">+</button>
                <button class="cb cb-zero" data-num="0">0</button>
                <button class="cb" data-num=".">.</button>
                <button class="cb cb-eq" data-action="equals">=</button>
            </div>
        </div>
    </div>

    <!-- Backdrop for popups -->
    <div class="global-popup-backdrop" id="globalBackdrop"></div>


    <!-- Main Content -->
    <div class="container mt-4">
        <h2 class="page-title">üìÅ <span data-i18n="categories_title">Category Management</span></h2>
        <hr>

        <!-- Category Form -->
        <div class="row">
            <div class="col-md-12">
                <div class="card category-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0" data-i18n="categories_title">Add/Edit Category</h5>
                    </div>
                    <div class="card-body">
                        <form id="categoryForm">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="txtCategoryName" data-i18n="categories_name">Category Name</label>
                                        <input type="text" class="form-control" id="txtCategoryName"
                                               data-i18n="categories_name" placeholder="e.g., Electronics" required>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="form-group">
                                        <label for="txtDescription" data-i18n="categories_description">Description</label>
                                        <input type="text" class="form-control" id="txtDescription"
                                               data-i18n="categories_description" placeholder="Optional description">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label for="txtStatus" data-i18n="items_status">Status</label>
                                        <select class="form-control" id="txtStatus">
                                            <option value="true" data-i18n="items_active">Active</option>
                                            <option value="false" data-i18n="items_inactive">Inactive</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <button type="button" class="btn btn-success" id="btnSave">
                                        üíæ <span data-i18n="categories_save">Save Category</span>
                                    </button>
                                    <button type="button" class="btn btn-primary" id="btnUpdate" style="display:none;">
                                        ‚úèÔ∏è <span data-i18n="categories_update">Update Category</span>
                                    </button>
                                    <button type="button" class="btn btn-danger" id="btnDelete" style="display:none;">
                                        üóëÔ∏è <span data-i18n="categories_delete">Delete Category</span>
                                    </button>
                                    <button type="button" class="btn btn-warning" id="btnClear">
                                        üîÑ <span data-i18n="clear">Clear Form</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Categories List -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card category-card">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">üìã <span data-i18n="categories_title">All Categories</span></h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="categoriesList">
                            <!-- Categories loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-5 py-3 bg-dark text-white text-center">
        <p>&copy; 2025 POS System. All rights reserved.</p>
    </footer>

    <!-- jQuery & Bootstrap -->
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!-- Language Support -->
    <script src="js/languages.js"></script>
    <!-- Global Navbar JS -->
    <script src="js/navbar-global.js"></script>

    <!-- Controller -->
    <script>
        const API_URL = "http://localhost:8080/api/categories";
        let currentCategoryId = null;

        $(document).ready(function() {
            loadCategories();
            
            $('#btnSave').click(saveCategory);
            $('#btnUpdate').click(updateCategory);
            $('#btnDelete').click(deleteCategory);
            $('#btnClear').click(clearForm);
        });

        function loadCategories() {
            $.ajax({
                url: API_URL,
                method: "GET",
                success: function(categories) {
                    displayCategories(categories);
                },
                error: function() {
                    showNotification(t('msg_error'), "error");
                }
            });
        }

        function displayCategories(categories) {
            const list = $('#categoriesList');
            list.empty();

            if (categories.length === 0) {
                list.html('<div class="text-center py-4">' + t('pos_cart_empty') + '</div>');
                return;
            }

            categories.forEach(cat => {
                const statusClass = cat.active ? 'badge-active' : 'badge-inactive';
                const statusText = cat.active ? t('items_active') : t('items_inactive');

                const item = $(`
                    <div class="category-item">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <strong>${cat.name}</strong>
                            </div>
                            <div class="col-md-5">
                                ${cat.description || '‚Äî'}
                            </div>
                            <div class="col-md-2">
                                <span class="${statusClass}">${statusText}</span>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-sm btn-primary" onclick="editCategory(${cat.id})">
                                    ‚úèÔ∏è ${t('edit')}
                                </button>
                            </div>
                        </div>
                    </div>
                `);
                list.append(item);
            });
        }

        function saveCategory() {
            const data = {
                name: $('#txtCategoryName').val().trim(),
                description: $('#txtDescription').val().trim() || null,
                active: $('#txtStatus').val() === 'true'
            };

            if (!data.name) {
                showNotification(t('categories_name') + ' is required', "warning");
                return;
            }

            $.ajax({
                url: API_URL,
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function() {
                    showNotification(t('categories_title') + ' ' + t('msg_saved'), "success");
                    clearForm();
                    loadCategories();
                },
                error: function() {
                    showNotification(t('msg_error'), "error");
                }
            });
        }

        function editCategory(id) {
            $.ajax({
                url: `${API_URL}/${id}`,
                method: "GET",
                success: function(cat) {
                    currentCategoryId = cat.id;
                    $('#txtCategoryName').val(cat.name);
                    $('#txtDescription').val(cat.description);
                    $('#txtStatus').val(cat.active ? 'true' : 'false');
                    
                    $('#btnSave').hide();
                    $('#btnUpdate, #btnDelete').show();
                }
            });
        }

        function updateCategory() {
            const data = {
                id: currentCategoryId,
                name: $('#txtCategoryName').val().trim(),
                description: $('#txtDescription').val().trim() || null,
                active: $('#txtStatus').val() === 'true'
            };

            $.ajax({
                url: `${API_URL}/${currentCategoryId}`,
                method: "PUT",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function() {
                    showNotification(t('categories_title') + ' ' + t('msg_updated'), "success");
                    clearForm();
                    loadCategories();
                },
                error: function() {
                    showNotification(t('msg_error'), "error");
                }
            });
        }

        function deleteCategory() {
            if (!confirm(t('msg_confirm_delete') + '?')) return;

            $.ajax({
                url: `${API_URL}/${currentCategoryId}`,
                method: "DELETE",
                success: function() {
                    showNotification(t('categories_title') + ' ' + t('msg_deleted'), "success");
                    clearForm();
                    loadCategories();
                },
                error: function() {
                    showNotification(t('msg_error'), "error");
                }
            });
        }

        function clearForm() {
            $('#categoryForm')[0].reset();
            currentCategoryId = null;
            $('#btnSave').show();
            $('#btnUpdate, #btnDelete').hide();
        }

        function showNotification(message, type) {
            const alertClass = type === 'success' ? 'alert-success' : 
                             type === 'error' ? 'alert-danger' : 'alert-warning';
            
            const alert = $(`
                <div class="alert ${alertClass} alert-dismissible fade show" 
                     style="position:fixed;top:70px;right:20px;z-index:9999;min-width:300px;">
                    ${message}
                    <button type="button" class="close" data-dismiss="alert">
                        <span>&times;</span>
                    </button>
                </div>
            `);
            
            $('body').append(alert);
            setTimeout(() => alert.alert('close'), 3000);
        }

        // Re-render dynamic content when language changes
        window.addEventListener('languageChanged', () => loadCategories());
    </script>

</body>
</html>