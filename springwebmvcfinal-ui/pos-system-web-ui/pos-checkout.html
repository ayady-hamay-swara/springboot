<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فرۆشتن - سیستەمی فرۆشگا</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/navbar-global.css">
    <link rel="stylesheet" href="css/pos-checkout.css">
</head>
<body>

<!-- Global Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary global-navbar">
    <a class="navbar-brand font-weight-bold" href="index.html">🏪 سیستەمی فرۆشتن</a>

    <div class="navbar-left-actions">
        <button class="nav-icon-btn" id="btnGlobalSettings">⚙️</button>
        <button class="nav-icon-btn" id="btnGlobalCalc">🧮</button>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#globalNavbar">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="globalNavbar">
        <ul class="navbar-nav mx-auto">
            <li class="nav-item"><a class="nav-link" href="index.html">سەرەکی</a></li>
            <li class="nav-item"><a class="nav-link" href="manage-items.html">کاڵاکان</a></li>
            <li class="nav-item"><a class="nav-link" href="manage-employees.html">کارمەندان</a></li>
            <li class="nav-item active"><a class="nav-link" href="pos-checkout.html">🛒 فرۆشتن</a></li>
            <li class="nav-item"><a class="nav-link" href="search-orders.html">وەسڵەکان</a></li>
        </ul>

        <ul class="navbar-nav ml-auto">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="langDropdown" data-toggle="dropdown">
                    🌐 <span id="currentLangLabel">کوردی</span>
                </a>
                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="#" onclick="setLanguage('ku'); return false;">🟥🟩⚪ کوردی</a>
                    <a class="dropdown-item" href="#" onclick="setLanguage('en'); return false;">🇬🇧 English</a>
                    <a class="dropdown-item" href="#" onclick="setLanguage('ar'); return false;">🇸🇦 العربية</a>
                </div>
            </li>
            <li class="nav-item">
                <span class="nav-link text-warning">👤 <strong id="navbarUsername">بەڕێوەبەر</strong></span>
            </li>
        </ul>
    </div>
</nav>

<!-- Settings & Calculator -->
<div class="global-popup" id="globalSettingsPanel">
    <div class="popup-header">
        <span>⚙️ ڕێکخستنەکان</span>
        <button class="popup-close" id="settingsCloseBtn">✕</button>
    </div>
    <div class="settings-body">
        <div class="settings-section">
            <div class="settings-label">ناوی فرۆشگا</div>
            <input type="text" id="globalStoreName" class="settings-input" placeholder="فرۆشگای من">
        </div>
        <div class="settings-section">
            <div class="settings-label">ڕێژەی باج (%)</div>
            <input type="number" id="globalTaxRate" class="settings-input" placeholder="0" min="0" max="100" step="0.1">
        </div>
        <div class="settings-section">
            <div class="settings-label">چاپی خۆکار</div>
            <label class="toggle-label">
                <input type="checkbox" id="globalAutoPrint">
                <span class="toggle-track"></span>
                <span class="toggle-text">ناچالاک</span>
            </label>
        </div>
        <div class="settings-section">
            <div class="settings-label">دەنگ لە زیادکردن</div>
            <label class="toggle-label">
                <input type="checkbox" id="globalSound" checked>
                <span class="toggle-track"></span>
                <span class="toggle-text">چالاک</span>
            </label>
        </div>
        <div class="settings-section">
            <div class="settings-label">ناوی بەکارهێنەر</div>
            <input type="text" id="globalCashierName" class="settings-input" placeholder="بەڕێوەبەر">
        </div>
        <button class="settings-save-btn" id="btnGlobalSaveSettings">💾 پاشەکەوت</button>
    </div>
</div>

<div class="global-popup" id="globalCalcPanel">
    <div class="popup-header">
        <span>🧮 ژمێرەر</span>
        <button class="popup-close" id="calcCloseBtn">✕</button>
    </div>
    <div class="calc-wrap">
        <div class="calc-display">
            <div class="calc-expr" id="globalCalcExpr">&nbsp;</div>
            <div class="calc-result" id="globalCalcResult">0</div>
        </div>
        <div class="calc-grid">
            <button class="cb cb-fn" data-action="clear">AC</button>
            <button class="cb cb-fn" data-action="sign">+/−</button>
            <button class="cb cb-fn" data-action="percent">%</button>
            <button class="cb cb-op" data-op="÷">÷</button>
            <button class="cb" data-num="7">7</button>
            <button class="cb" data-num="8">8</button>
            <button class="cb" data-num="9">9</button>
            <button class="cb cb-op" data-op="×">×</button>
            <button class="cb" data-num="4">4</button>
            <button class="cb" data-num="5">5</button>
            <button class="cb" data-num="6">6</button>
            <button class="cb cb-op" data-op="−">−</button>
            <button class="cb" data-num="1">1</button>
            <button class="cb" data-num="2">2</button>
            <button class="cb" data-num="3">3</button>
            <button class="cb cb-op" data-op="+">+</button>
            <button class="cb cb-zero" data-num="0">0</button>
            <button class="cb" data-num=".">.</button>
            <button class="cb cb-eq" data-action="equals">=</button>
        </div>
    </div>
</div>

<div class="global-popup-backdrop" id="globalBackdrop"></div>

<!-- POS Layout -->
<div class="pos-wrapper">
    <div class="pos-layout">

        <!-- LEFT PANEL -->
        <div class="pos-left">
            
            <!-- Stats Bar -->
            <div class="stats-bar">
                <div class="stat-pill">
                    <span class="stat-lbl">فرۆشی ئەمڕۆ</span>
                    <span class="stat-val" id="todaySales">IQD 0</span>
                </div>
                <div class="stat-pill">
                    <span class="stat-lbl">وەسڵەکان</span>
                    <span class="stat-val" id="todayTransactions">0</span>
                </div>
                <div class="stat-pill">
                    <span class="stat-lbl">کاشێر</span>
                    <span class="stat-val" id="cashierName">بەڕێوەبەر</span>
                </div>
            </div>

            <!-- Search + Category -->
            <div class="search-row">
                <div class="search-wrap">
                    <span class="search-icon">🔍</span>
                    <input type="text" id="productSearch" class="search-input"
                           placeholder="گەڕان بە ناو، کۆد یان بارکۆد..." autofocus>
                    <div class="product-results" id="productResults" style="display:none;"></div>
                </div>
                <select id="categoryFilter" class="category-select">
                    <option value="">هەموو جۆرەکان</option>
                </select>
            </div>

            <!-- Cart Box -->
            <div class="cart-box">
                <div class="cart-box-header">
                    <span>🛒 کاڵاکانی سەبەتە <span class="cart-count" id="cartCount">0 دانە</span></span>
                    <button class="btn-clear-cart" id="btnClearCart">🗑 پاککردنەوە</button>
                </div>
                <div class="cart-table-head">
                    <span class="col-name">کاڵا</span>
                    <span class="col-qty">ژمارە</span>
                    <span class="col-price">نرخی یەک</span>
                    <span class="col-total">کۆی گشتی</span>
                    <span class="col-action"></span>
                </div>
                <div class="cart-table-body" id="cartItems">
                    <div class="cart-empty">
                        <div style="font-size:48px;">🛒</div>
                        <p>سەبەتە بەتاڵە</p>
                        <small>کاڵایەک بگەڕێ یان سکان بکە</small>
                    </div>
                </div>
            </div>

            <!-- Totals Bar -->
            <div class="totals-bar">
                <div class="total-item">
                    <span class="total-lbl">کۆی لاوەکی:</span>
                    <span class="total-val" id="subtotal">IQD 0</span>
                </div>
                <div class="total-item discount-item">
                    <span class="total-lbl">داشکاندن:</span>
                    <input type="number" id="discountPercent" class="discount-input" value="0" min="0" max="100" step="1">
                    <span class="total-lbl">%</span>
                    <span class="total-val text-danger" id="discountAmount">- IQD 0</span>
                </div>
                <div class="total-item total-final">
                    <span class="total-lbl">کۆی گشتی:</span>
                    <span class="total-val" id="totalAmount">IQD 0</span>
                </div>
            </div>

        </div>

        <!-- RIGHT PANEL (simplified - no customer, no currency) -->
        <div class="pos-right">

            <!-- Payment Method -->
            <div class="right-section payment-section">
                <div class="right-section-title">💳 شێوازی پارەدان</div>
                <div class="payment-btns">
                    <button class="pay-btn active" data-method="CASH">💵 کاش</button>
                    <button class="pay-btn" data-method="CARD">💳 کارت</button>
                    <button class="pay-btn" data-method="TRANSFER">🏦 گواستنەوە</button>
                </div>
                <div id="cashSection" class="cash-section">
                    <label class="cash-label">بڕی وەرگیراو</label>
                    <input type="number" id="amountReceived" class="cash-input" placeholder="0" step="1000">
                    <div class="change-row">
                        <span>پارەی ماوە:</span>
                        <span id="changeAmount" class="change-val">IQD 0</span>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="right-section action-section">
                <button class="btn-complete" id="btnCompleteSale">✅ تەواوکردنی فرۆشتن</button>
                <div class="btn-row-2">
                    <button class="btn-hold" id="btnHold">⏸ ڕاگرتن</button>
                    <button class="btn-cancel" id="btnCancel">✕ هەڵوەشاندنەوە</button>
                </div>
                <button class="btn-return" id="btnReturn">↩ گەڕاندنەوە</button>
            </div>

        </div>
    </div>
</div>

<!-- Receipt Modal -->
<div class="modal fade" id="receiptModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">✅ فرۆشتن تەواو بوو!</h5>
                <button type="button" class="close text-white" data-dismiss="modal"><span>×</span></button>
            </div>
            <div class="modal-body" id="receiptContent"></div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="window.print()">🖨️ چاپ</button>
                <button class="btn btn-success" data-dismiss="modal" id="btnNewSale">➕ فرۆشتنی نوێ</button>
            </div>
        </div>
    </div>
</div>

<!-- Return Modal -->
<div class="modal fade" id="returnModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title">↩ گەڕاندنەوە</h5>
                <button type="button" class="close" data-dismiss="modal"><span>×</span></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ژمارەی وەسڵ</label>
                    <input type="text" class="form-control" id="returnOrderNumber" placeholder="ORD0000001">
                </div>
                <div class="form-group">
                    <label>هۆکار</label>
                    <select class="form-control" id="returnReason">
                        <option value="">هەڵبژێرە...</option>
                        <option value="DEFECTIVE">کاڵا خراپە</option>
                        <option value="WRONG_ITEM">کاڵای هەڵە</option>
                        <option value="CUSTOMER_CHANGE">کڕیار بیری گۆڕی</option>
                        <option value="OTHER">هۆکاری تر</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>تێبینی</label>
                    <textarea class="form-control" id="returnNotes" rows="2"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal">هەڵوەشاندنەوە</button>
                <button class="btn btn-warning" id="btnProcessReturn">جێبەجێکردن</button>
            </div>
        </div>
    </div>
</div>

<script src="js/languages.js"></script>
<script src="js/navbar-global.js"></script>
<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/pos-checkout-controller.js"></script>
</body>
</html>
