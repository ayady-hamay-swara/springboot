<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="debts_title">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ù‚Û•Ø±Ø²</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/navbar-global.css">
    <style>
        body { background: #f5f7fa; }
        .page-title { color: #e74c3c; font-weight: 800; font-size: 32px; margin-bottom: 20px; }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; border-radius: 16px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,.1); display: flex; align-items: center; gap: 20px; }
        .stat-icon { font-size: 48px; }
        .stat-info h3 { font-size: 28px; font-weight: 800; margin: 0; }
        .stat-info p { font-size: 14px; color: #7f8c8d; margin: 5px 0 0 0; }
        .stat-card.red .stat-info h3 { color: #e74c3c; }
        .stat-card.green .stat-info h3 { color: #27ae60; }
        .stat-card.blue .stat-info h3 { color: #3498db; }
        
        /* Form Card */
        .card { border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,.1); border: none; margin-bottom: 20px; }
        .card-header { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border-radius: 16px 16px 0 0 !important; padding: 15px 20px; font-weight: 700; }
        .form-label { font-weight: 700; font-size: 14px; color: #2c3e50; margin-bottom: 5px; }
        .form-control, .form-select { border-radius: 8px; border: 2px solid #d0d9e8; padding: 10px; }
        .form-control:focus, .form-select:focus { border-color: #e74c3c; box-shadow: 0 0 0 3px rgba(231,76,60,.1); }
        
        /* Buttons */
        .btn { border-radius: 10px; font-weight: 700; padding: 10px 20px; }
        .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); border: none; }
        .btn-success { background: linear-gradient(135deg, #27ae60, #229954); border: none; }
        .btn-warning { background: linear-gradient(135deg, #f39c12, #e67e22); border: none; }
        
        /* Table */
        .table { margin: 0; }
        .table thead th { background: #2c3e50; color: white; font-weight: 700; font-size: 13px; border: none; padding: 12px; white-space: nowrap; }
        .table tbody td { padding: 12px; vertical-align: middle; border-color: #ecf0f1; }
        .table tbody tr { transition: background .15s; }
        .table tbody tr:hover { background: #fff5f5; }
        
        /* Status Badges */
        .badge { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; }
        .badge-unpaid { background: #e74c3c; color: white; }
        .badge-partial { background: #f39c12; color: white; }
        .badge-paid { background: #27ae60; color: white; }
        
        /* Amount Display */
        .amount-unpaid { color: #e74c3c; font-weight: 800; font-size: 16px; }
        .amount-paid { color: #27ae60; font-weight: 800; }
        
        /* Action Buttons */
        .btn-sm { padding: 5px 10px; font-size: 12px; }
        
        /* Search Section */
        .search-card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,.08); margin-bottom: 20px; }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary global-navbar">
    <a class="navbar-brand font-weight-bold" href="index.html">ğŸª <span data-i18n="brand_name">Ø³ÛŒØ³ØªÛ•Ù…ÛŒ ÙØ±Û†Ø´ØªÙ†</span></a>
    <div class="navbar-left-actions">
        <button class="nav-icon-btn" id="btnGlobalSettings">âš™ï¸</button>
        <button class="nav-icon-btn" id="btnGlobalCalc">ğŸ§®</button>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#globalNavbar">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="globalNavbar">
        <ul class="navbar-nav mx-auto">
            <li class="nav-item"><a class="nav-link" href="index.html" data-i18n="nav_home">Ø³Û•Ø±Û•Ú©ÛŒ</a></li>
            <li class="nav-item"><a class="nav-link" href="manage-items.html" data-i18n="nav_items">Ú©Ø§ÚµØ§Ú©Ø§Ù†</a></li>
            <li class="nav-item"><a class="nav-link" href="manage-employees.html" data-i18n="nav_employees">Ú©Ø§Ø±Ù…Û•Ù†Ø¯Ø§Ù†</a></li>
            <li class="nav-item"><a class="nav-link" href="pos-checkout.html">ğŸ›’ <span data-i18n="nav_pos">ÙØ±Û†Ø´ØªÙ†</span></a></li>
            <li class="nav-item active"><a class="nav-link" href="search-orders.html">ğŸ’³ <span data-i18n="nav_debts">Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†</span></a></li>
        </ul>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="langDropdown" data-toggle="dropdown">
                    ğŸŒ <span id="currentLangLabel">Ú©ÙˆØ±Ø¯ÛŒ</span>
                </a>
                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="#" onclick="setLanguage('ku'); return false;"> Ú©ÙˆØ±Ø¯ÛŒ</a>
                    <a class="dropdown-item" href="#" onclick="setLanguage('en'); return false;"> English</a>
                    <a class="dropdown-item" href="#" onclick="setLanguage('ar'); return false;"> Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</a>
                </div>
            </li>
            <li class="nav-item">
                <span class="nav-link text-warning">ğŸ‘¤ <strong id="navbarUsername">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±</strong></span>
            </li>
        </ul>
    </div>
</nav>

<!-- Settings Popup -->
<div class="global-popup" id="globalSettingsPanel">
    <div class="popup-header">
        <span>âš™ï¸ <span data-i18n="settings_title">Ú•ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†</span></span>
        <button class="popup-close" id="settingsCloseBtn">âœ•</button>
    </div>
    <div class="settings-body">
        <div class="settings-section">
            <div class="settings-label" data-i18n="settings_store">Ù†Ø§ÙˆÛŒ ÙØ±Û†Ø´Ú¯Ø§</div>
            <input type="text" id="globalStoreName" class="settings-input" placeholder="ÙØ±Û†Ø´Ú¯Ø§ÛŒ Ù…Ù†">
        </div>
        <div class="settings-section">
            <div class="settings-label" data-i18n="settings_tax">Ú•ÛÚ˜Û•ÛŒ Ø¨Ø§Ø¬ (%)</div>
            <input type="number" id="globalTaxRate" class="settings-input" placeholder="0" min="0" max="100" step="0.1">
        </div>
        <div class="settings-section">
            <div class="settings-label" data-i18n="settings_auto_print">Ú†Ø§Ù¾ÛŒ Ø®Û†Ú©Ø§Ø±</div>
            <label class="toggle-label">
                <input type="checkbox" id="globalAutoPrint">
                <span class="toggle-track"></span>
                <span class="toggle-text" data-i18n="toggle_off">Ù†Ø§Ú†Ø§Ù„Ø§Ú©</span>
            </label>
        </div>
        <div class="settings-section">
            <div class="settings-label" data-i18n="settings_sound">Ø¯Û•Ù†Ú¯ Ù„Û• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†</div>
            <label class="toggle-label">
                <input type="checkbox" id="globalSound" checked>
                <span class="toggle-track"></span>
                <span class="toggle-text" data-i18n="toggle_on">Ú†Ø§Ù„Ø§Ú©</span>
            </label>
        </div>
        <div class="settings-section">
            <div class="settings-label" data-i18n="settings_cashier_name">Ù†Ø§ÙˆÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±</div>
            <input type="text" id="globalCashierName" class="settings-input" placeholder="Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±">
        </div>
        <button class="settings-save-btn" id="btnGlobalSaveSettings">ğŸ’¾ <span data-i18n="settings_save">Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª</span></button>
    </div>
</div>

<!-- Calculator Popup -->
<div class="global-popup" id="globalCalcPanel">
    <div class="popup-header">
        <span>ğŸ§® <span data-i18n="calc_title">Ú˜Ù…ÛØ±Û•Ø±</span></span>
        <button class="popup-close" id="calcCloseBtn">âœ•</button>
    </div>
    <div class="calc-wrap">
        <div class="calc-display">
            <div class="calc-expr" id="globalCalcExpr">&nbsp;</div>
            <div class="calc-result" id="globalCalcResult">0</div>
        </div>
        <div class="calc-grid">
            <button class="cb cb-fn" data-action="clear">AC</button>
            <button class="cb cb-fn" data-action="sign">+/âˆ’</button>
            <button class="cb cb-fn" data-action="percent">%</button>
            <button class="cb cb-op" data-op="Ã·">Ã·</button>
            <button class="cb" data-num="7">7</button>
            <button class="cb" data-num="8">8</button>
            <button class="cb" data-num="9">9</button>
            <button class="cb cb-op" data-op="Ã—">Ã—</button>
            <button class="cb" data-num="4">4</button>
            <button class="cb" data-num="5">5</button>
            <button class="cb" data-num="6">6</button>
            <button class="cb cb-op" data-op="âˆ’">âˆ’</button>
            <button class="cb" data-num="1">1</button>
            <button class="cb" data-num="2">2</button>
            <button class="cb" data-num="3">3</button>
            <button class="cb cb-op" data-op="+">+</button>
            <button class="cb cb-zero" data-num="0">0</button>
            <button class="cb" data-num=".">.</button>
            <button class="cb cb-eq" data-action="equals">=</button>
        </div>
    </div>
</div>

<div class="global-popup-backdrop" id="globalBackdrop"></div>

<!-- Main Content -->
<div class="container-fluid mt-4">
    
    <!-- Page Title -->
    <h2 class="page-title">ğŸ’³ <span data-i18n="debts_title">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†</span></h2>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card red">
            <div class="stat-icon">ğŸ’¸</div>
            <div class="stat-info">
                <h3 id="totalDebt">IQD 0</h3>
                <p data-i18n="debts_total">Ú©Û†ÛŒ Ù‚Û•Ø±Ø²</p>
            </div>
        </div>
        <div class="stat-card green">
            <div class="stat-icon">âœ…</div>
            <div class="stat-info">
                <h3 id="totalPaid">IQD 0</h3>
                <p data-i18n="debts_total_paid">ÙˆØ§Ø±Ø¯Ø¨ÙˆÙˆÛŒ Ú¯Ø´ØªÛŒ</p>
            </div>
        </div>
        <div class="stat-card blue">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-info">
                <h3 id="totalCustomers">0</h3>
                <p data-i18n="debts_total_customers">Ú˜Ù…Ø§Ø±Û•ÛŒ Ù‚Û•Ø±Ø²Ø§Ø±Ø§Ù†</p>
            </div>
        </div>
    </div>

    <!-- Add Debt Form -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">â• <span data-i18n="debts_add">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù‚Û•Ø±Ø²ÛŒ Ù†ÙˆÛ</span></h5>
        </div>
        <div class="card-body">
            <form id="debtForm">
                <div class="row">
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label" data-i18n="debts_customer_name">Ù†Ø§ÙˆÛŒ Ú©Û•Ø³ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="txtCustomerName" required>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="mb-3">
                            <label class="form-label" data-i18n="debts_phone">Ú˜Ù…Ø§Ø±Û• Ù…Û†Ø¨Ø§ÛŒÙ„</label>
                            <input type="text" class="form-control" id="txtPhone" placeholder="0750...">
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="mb-3">
                            <label class="form-label" data-i18n="debts_amount">Ø¨Ú•ÛŒ Ù‚Û•Ø±Ø² (IQD) <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="txtAmount" step="1000" required>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="mb-3">
                            <label class="form-label" data-i18n="debts_date">Ø¨Û•Ø±ÙˆØ§Ø±</label>
                            <input type="date" class="form-control" id="txtDate">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label" data-i18n="debts_notes">ØªÛØ¨ÛŒÙ†ÛŒ</label>
                            <input type="text" class="form-control" id="txtNotes" placeholder="Ø¨Û† Ú©Ú•ÛŒÙ†ÛŒ...">
                        </div>
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-danger" id="btnSave">ğŸ’¾ <span data-i18n="save">Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª</span></button>
                    <button type="button" class="btn btn-primary" id="btnUpdate" style="display:none;">âœï¸ <span data-i18n="debts_update">Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</span></button>
                    <button type="button" class="btn btn-secondary" id="btnClear">ğŸ”„ <span data-i18n="clear">Ù¾Ø§ÙƒÙƒØ±Ø¯Ù†Û•ÙˆÛ•</span></button>
                </div>
            </form>
        </div>
    </div>

    <!-- Search & Filter -->
    <div class="search-card">
        <div class="row">
            <div class="col-md-4">
                <input type="text" class="form-control" id="txtSearch" data-i18n="debts_search" placeholder="Ú¯Û•Ú•Ø§Ù† Ø¨Û• Ù†Ø§Ùˆ ÛŒØ§Ù† Ú˜Ù…Ø§Ø±Û• Ù…Û†Ø¨Ø§ÛŒÙ„...">
            </div>
            <div class="col-md-3">
                <select class="form-select" id="filterStatus">
                    <option value="" data-i18n="debts_all_status">Ù‡Û•Ù…ÙˆÙˆ Ø¯Û†Ø®Û•Ú©Ø§Ù†</option>
                    <option value="unpaid" data-i18n="debts_status_unpaid">Ù‚Û•Ø±Ø² (Ù†Û•Ø¯Ø±Ø§ÙˆÛ•)</option>
                    <option value="partial" data-i18n="debts_status_partial">Ø¨Û•Ø´ÛÚ©ÛŒ Ø¯Ø±Ø§ÙˆÛ•</option>
                    <option value="paid" data-i18n="debts_status_paid">ØªÛ•ÙˆØ§Ùˆ Ø¯Ø±Ø§ÙˆÛ•</option>
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="filterSort">
                    <option value="date_desc" data-i18n="debts_sort_newest">Ù†ÙˆÛØªØ±ÛŒÙ†</option>
                    <option value="date_asc" data-i18n="debts_sort_oldest">Ú©Û†Ù†ØªØ±ÛŒÙ†</option>
                    <option value="amount_desc" data-i18n="debts_sort_highest">Ø²Û†Ø±ØªØ±ÛŒÙ† Ù‚Û•Ø±Ø²</option>
                    <option value="amount_asc" data-i18n="debts_sort_lowest">Ú©Û•Ù…ØªØ±ÛŒÙ† Ù‚Û•Ø±Ø²</option>
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-warning w-100" id="btnExport">ğŸ“Š <span data-i18n="debts_export">Ø¯Û•Ø±Ù‡ÛÙ†Ø§Ù†</span></button>
            </div>
        </div>
    </div>

    <!-- Debts Table -->
    <div class="card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Ú˜.</th>
                            <th data-i18n="debts_customer_name">Ù†Ø§ÙˆÛŒ Ú©Û•Ø³</th>
                            <th data-i18n="debts_phone">Ù…Û†Ø¨Ø§ÛŒÙ„</th>
                            <th data-i18n="debts_amount">Ø¨Ú•ÛŒ Ù‚Û•Ø±Ø²</th>
                            <th data-i18n="debts_paid_amount">ÙˆØ§Ø±Ø¯Ø¨ÙˆÙˆÛŒ</th>
                            <th data-i18n="debts_remaining">Ù…Ø§ÙˆÛ•</th>
                            <th data-i18n="debts_status">Ø¯Û†Ø®</th>
                            <th data-i18n="debts_date">Ø¨Û•Ø±ÙˆØ§Ø±</th>
                            <th data-i18n="debts_notes">ØªÛØ¨ÛŒÙ†ÛŒ</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="debtsTableBody">
                        <tr>
                            <td colspan="10" class="text-center py-5">
                                <div style="font-size:48px;">ğŸ’³</div>
                                <p class="text-muted" data-i18n="debts_empty">Ù‡ÛŒÚ† Ù‚Û•Ø±Ø²ÛÚ© ØªÛ†Ù…Ø§Ø± Ù†Û•Ú©Ø±Ø§ÙˆÛ•</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<!-- Payment Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">ğŸ’° <span data-i18n="debts_payment_title">ÙˆØ§Ø±Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù¾Ø§Ø±Û•</span></h5>
                <button type="button" class="close text-white" data-dismiss="modal"><span>Ã—</span></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <strong id="paymentCustomerName"></strong>
                    <div class="text-muted" id="paymentDebtInfo"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label" data-i18n="debts_payment_amount">Ø¨Ú•ÛŒ Ù¾Ø§Ø±Û•ÛŒ ÙˆØ§Ø±Ø¯ (IQD)</label>
                    <input type="number" class="form-control form-control-lg" id="txtPaymentAmount" step="1000">
                </div>
                <div class="mb-3">
                    <label class="form-label" data-i18n="debts_payment_notes">ØªÛØ¨ÛŒÙ†ÛŒ</label>
                    <input type="text" class="form-control" id="txtPaymentNotes" placeholder="ÙˆØ§Ø±Ø¯Ú©Ø±Ø§ Ù„Û•...">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" data-i18n="cancel">Ù‡Û•ÚµÙˆÛ•Ø´Ø§Ù†Ø¯Ù†Û•ÙˆÛ•</button>
                <button class="btn btn-success" id="btnConfirmPayment">âœ… <span data-i18n="debts_confirm">ÙˆØ§Ø±Ø¯Ú©Ø±Ø¯Ù†</span></button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">âš ï¸ <span data-i18n="debts_confirm">Ø¯ÚµÙ†ÛŒØ§Ø¨ÙˆÙˆÙ†Û•ÙˆÛ•</span></h5>
                <button type="button" class="close text-white" data-dismiss="modal"><span>Ã—</span></button>
            </div>
            <div class="modal-body">
                <p data-i18n="debts_confirm_delete">Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ù… Ù‚Û•Ø±Ø²Û•ØŸ</p>
                <p class="text-danger mb-0"><strong data-i18n="debts_irreversible">Ø¦Û•Ù… Ú©Ø±Ø¯Ø§Ø±Û• Ù†Ø§Ú¯Û•Ú•ÛØªÛ•ÙˆÛ•!</strong></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" data-i18n="cancel">Ù‡Û•ÚµÙˆÛ•Ø´Ø§Ù†Ø¯Ù†Û•ÙˆÛ•</button>
                <button class="btn btn-danger" id="btnConfirmDelete">ğŸ—‘ï¸ <span data-i18n="delete">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</span></button>
            </div>
        </div>
    </div>
</div>

<script src="js/languages.js"></script>
<script src="js/navbar-global.js"></script>
<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/manage-debts-controller.js"></script>
</body>
</html>